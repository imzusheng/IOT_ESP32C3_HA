# 4A-REFACTOR: 性能显示修复与LED初始化优化

## 问题描述

基于日志分析发现的系统问题：

### 1. 性能显示错误（关键问题）
- **现象**: `[00:01:16] [INFO ] [MAIN] 系统状态 - 状态:ERROR, 内存:98KB(36%), 性能:0.0Hz, WiFi:True, MQTT:False`
- **问题**: 性能显示为 0.0Hz，表明主循环频率计算逻辑有误

### 2. LED初始化顺序问题
- **现象**: LED在状态机和网络管理器之后才初始化
- **问题**: LED作为用户反馈的重要组件，应该最先初始化并提供运行状态指示
- **期望**: LED应在系统启动后立即初始化，并启动慢速闪烁表示运行中

### 3. 运行逻辑分析
从日志时间序列分析：
- `[00:00:10]` - 系统组件初始化 
- `[00:01:16]` - MQTT连接失败，进入ERROR状态
- `[00:01:16]` - LED初始化（过晚）
- `[00:01:16]` - 主循环开始
- `[00:01:16]` - 性能显示错误（0.0Hz）

## 根因假设

### 性能计算错误
1. **初始化时机问题**: 在首次统计输出时，`loop_count` 可能未正确累积
2. **时间窗口问题**: `last_stats_time` 初始化为0，导致首次计算时间窗口异常
3. **计算逻辑问题**: 30秒窗口内循环次数为0时，频率计算为0.0Hz

### LED初始化顺序问题
1. **优先级错误**: LED作为最基础的用户反馈组件，应该在网络组件之前初始化
2. **状态指示缺失**: 系统启动后没有立即提供运行状态的视觉反馈

## 修复目标

### 核心目标
1. **修复性能显示**: 确保Hz计算正确，避免显示0.0Hz
2. **优化LED初始化**: LED优先初始化，并立即启动运行状态指示
3. **保持现有功能**: 不影响其他模块的正常运行

### 验收标准
1. **性能显示正确**: 系统状态日志显示合理的Hz值（>0）
2. **LED提前初始化**: LED在网络组件之前完成初始化
3. **LED状态指示**: 初始化后立即启动慢速闪烁模式
4. **编译通过**: `/build.py -c` 成功通过
5. **功能完整**: 所有现有功能保持不变

## 风险与约束

### 低风险
- 性能计算逻辑修复：纯计算逻辑调整，不影响系统运行
- LED初始化顺序调整：LED模块独立性强，调整顺序风险低

### 约束条件
- 必须保持现有架构和代码风格
- 不允许引入新的依赖或复杂逻辑
- 必须确保向后兼容性

## 实施范围

### 主要修改文件
- `app/main.py`: 性能计算逻辑 + LED初始化顺序调整
- 可能需要调整主循环中的LED更新调用

### 不涉及修改
- LED模块本身（已有完善的API）
- 网络管理器和状态机
- 事件总线和配置系统